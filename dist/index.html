<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>New Age - Start Bootstrap Theme</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Google fonts-->
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,600;1,600&amp;display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,300;0,500;0,600;0,700;1,300;1,500;1,600;1,700&amp;display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;1,400&amp;display=swap" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <script src="https://d3js.org/d3.v6.min.js"></script>

        <style>

            .bar {
                fill: steelblue;
            }
            .line {
                fill: none;
                stroke: steelblue;
                stroke-width: 2px;
            }
            .axis text {
                font-size: 12px;
            }
            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }
        </style>
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top shadow-sm" id="mainNav">
            <div class="container px-5">
                <a class="navbar-brand fw-bold" href="#page-top">VIH DATA VISUALISATION</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="bi-list"></i>
                </button>

            </div>
        </nav>
        <!-- Mashead header-->
        <header class="masthead">
            <div class="container px-5 my-5">
                <!-- Title -->
                <div class="text-center mb-5">
                    <h1 class="display-4">Analyse des Décès liés au VIH</h1>
                    <p class="lead text-muted">Visualisation des données sur les décès dus au VIH par pays, continent, année et région.</p>
                </div>

                <!-- Rows for Charts -->
                <div class="row gx-5">
                    <div id="chart1" class="col-lg-4 mb-5 chart"></div>
                    <div id="chart2" class="col-lg-4 mb-5 chart"></div>
                    <div id="chart3" class="col-lg-4 mb-5 chart"></div>

                </div>
                <div class="row gx-5">
                    <div id="chart4" class="col-lg-4 mb-5 chart"></div>
                    <div id="chart5" class="col-lg-4 mb-5 chart"></div>
                    <div id="chart6" class="col-lg-4 mb-5 chart"></div>
                </div>
            </div>
            <div class="container px-5 my-5">
                <!-- Title -->
                <div class="text-center mb-5">
                    <h1 class="display-4">Analyse des Personnes Vivant avec le VIH</h1>
                    <p class="lead text-muted">Visualisation des données des personnes vivant avec le VIH par pays, année et région.</p>
                </div>

                <!-- Rows for Charts -->
                <div class="row gx-5">
                    <div id="chart7" class="col-lg-4 mb-5 chart"></div>
                    <div id="chart8" class="col-lg-4 mb-5 chart"></div>
                    <div id="chart9" class="col-lg-4 mb-5 chart"></div>

                </div>

            </div>

        </header>
        <!-- Quote/testimonial aside-->
        <aside class="text-center bg-gradient-primary-to-secondary">
            <div class="container px-5">
                <div class="row gx-5 justify-content-center">
                    <div class="col-xl-8">
                        <div class="h2 fs-1 text-white mb-4">Analyse des Personnes Vivant avec le VIH</div>
                        <img src="assets/img/tnw-logo.svg" alt="..." style="height: 3rem" />
                    </div>
                </div>
            </div>
        </aside>
        <!-- App features section-->
        <section id="features">

            <div class="flourish-embed flourish-chart" data-src="visualisation/21284381"><script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img src="https://public.flourish.studio/visualisation/21284381/thumbnail" width="100%" alt="chart visualization" /></noscript></div>
<!--            <div class="container px-5 my-5">-->
<!--                &lt;!&ndash; Title &ndash;&gt;-->
<!--                <div class="text-center mb-5">-->
<!--                    <h1 class="display-4">Analyse des Personnes Vivant avec le VIH</h1>-->
<!--                    <p class="lead text-muted">Visualisation des données des personnes vivant avec le VIH par pays, année et région.</p>-->
<!--                </div>-->

<!--                &lt;!&ndash; Rows for Charts &ndash;&gt;-->
<!--                <div class="row gx-5">-->
<!--                    <div id="chart7" class="col-lg-4 mb-5 chart"></div>-->
<!--                    <div id="chart8" class="col-lg-4 mb-5 chart"></div>-->
<!--                    <div id="chart9" class="col-lg-4 mb-5 chart"></div>-->

<!--                </div>-->
<!--              -->
<!--            </div>-->
        </section>
        <!-- Basic features section-->
        <section class="bg-light">
            <div class="container px-5">
                <div class="row gx-5 align-items-center justify-content-center justify-content-lg-between">
                    <div class="col-12 col-lg-5">
                        <h2 class="display-4 lh-1 mb-4">Enter a new age of web design</h2>
                        <p class="lead fw-normal text-muted mb-5 mb-lg-0">This section is perfect for featuring some information about your application, why it was built, the problem it solves, or anything else! There's plenty of space for text here, so don't worry about writing too much.</p>
                    </div>
                    <div class="col-sm-8 col-md-6">
                        <div class="px-5 px-sm-0"><img class="img-fluid rounded-circle" src="https://source.unsplash.com/u8Jn2rzYIps/900x900" alt="..." /></div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Call to action section-->
        <section class="cta">
            <div class="cta-content">
                <div class="container px-5">
                    <h2 class="text-white display-1 lh-1 mb-4">
                        Stop waiting.
                        <br />
                        Start building.
                    </h2>
                    <a class="btn btn-outline-light py-3 px-4 rounded-pill" href="https://startbootstrap.com/theme/new-age" target="_blank">Download for free</a>
                </div>
            </div>
        </section>
        <!-- App badge section-->
        <section class="bg-gradient-primary-to-secondary" id="download">
            <div class="container px-5">
                <h2 class="text-center text-white font-alt mb-4">Get the app now!</h2>
                <div class="d-flex flex-column flex-lg-row align-items-center justify-content-center">
                    <a class="me-lg-3 mb-4 mb-lg-0" href="#!"><img class="app-badge" src="assets/img/google-play-badge.svg" alt="..." /></a>
                    <a href="#!"><img class="app-badge" src="assets/img/app-store-badge.svg" alt="..." /></a>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="bg-black text-center py-5">
            <div class="container px-5">
                <div class="text-white-50 small">
                    <div class="mb-2">&copy; Your Website 2023. All Rights Reserved.</div>
                    <a href="#!">Privacy</a>
                    <span class="mx-1">&middot;</span>
                    <a href="#!">Terms</a>
                    <span class="mx-1">&middot;</span>
                    <a href="#!">FAQ</a>
                </div>
            </div>
        </footer>
        <!-- Feedback Modal-->
        <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-gradient-primary-to-secondary p-4">
                        <h5 class="modal-title font-alt text-white" id="feedbackModalLabel">Send feedback</h5>
                        <button class="btn-close btn-close-white" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!--        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>-->

        <script>
            const csvPath1 = "./data/vih_no_of_deaths_by_country_clean.csv";

            // Load CSV and parse data
            d3.csv(csvPath1, d => ({
                Pays: d.Country,
                Année: +d.Year,
                Décès_médian: +d.Count.match(/(\d+)\[/)[1],
                Décès_min: +d.Count.match(/\[(\d+)–/)[1],
                Décès_max: +d.Count.match(/–(\d+)\]/)[1],
                Région_OMS: d["WHO Region"]
            })).then(data => {
                // Prepare data for the charts
                const topCountriesDeaths = getTopItemsDeaths(data, "Pays", 5);
                const topRegionsDeaths = getTopItemsDeaths(data, "Région_OMS", 5);
                const yearlyTrendDeaths = getYearlyTrendDeaths(data);
                const regionDistributionDeaths = getRegionDistributionDeaths(data);
                const minMaxComparisonDeaths = getMinMaxComparisonDeaths(data);
                const yearlyMaxDeaths = getYearlyMaxDeathsDeaths(data);

                // Create the charts
                createBarChartDeaths(topCountriesDeaths, "#chart1", "Top 5 Pays les Plus Touchés");
                createBarChartDeaths(topRegionsDeaths, "#chart2", "Top 5 Régions les Plus Touchées");
                createLineChartDeaths(yearlyTrendDeaths, "#chart3", "Tendance des Décès par Année");
                createPieChartDeaths(regionDistributionDeaths, "#chart4", "Répartition par Région (OMS)");
                createBarChartDeaths(minMaxComparisonDeaths, "#chart5", "Comparaison Min/Max des Décès");
                createLineChartDeaths(yearlyMaxDeaths, "#chart6", "Maximum des Décès par Année");
            });

            // Helper functions for data aggregation
            function getTopItemsDeaths(data, field, count) {
                const aggregated = d3.rollup(data, v => d3.sum(v, d => d.Décès_médian), d => d[field]);
                return Array.from(aggregated, ([key, value]) => ({ key, value }))
                    .sort((a, b) => b.value - a.value)
                    .slice(0, count);
            }

            function getYearlyTrendDeaths(data) {
                const aggregated = d3.rollup(data, v => d3.sum(v, d => d.Décès_médian), d => d.Année);
                return Array.from(aggregated, ([year, count]) => ({ year, count })).sort((a, b) => a.year - b.year);
            }

            function getRegionDistributionDeaths(data) {
                const aggregated = d3.rollup(data, v => d3.sum(v, d => d.Décès_médian), d => d.Région_OMS);
                return Array.from(aggregated, ([region, count]) => ({ region, count }));
            }

            function getMinMaxComparisonDeaths(data) {
                return data.map(d => ({ key: d.Pays, min: d.Décès_min, max: d.Décès_max }));
            }

            function getYearlyMaxDeathsDeaths(data) {
                const aggregated = d3.rollup(data, v => d3.max(v, d => d.Décès_max), d => d.Année);
                return Array.from(aggregated, ([year, max]) => ({ year, max })).sort((a, b) => a.year - b.year);
            }

            // Chart Functions
            function createBarChartDeaths(data, selector, title) {
                const margin = { top: 40, right: 20, bottom: 40, left: 50 };
                const width = 400 - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                const svg = d3.select(selector)
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", -10)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(title);

                const x = d3.scaleBand()
                    .domain(data.map(d => d.key))
                    .range([0, width])
                    .padding(0.1);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.value)])
                    .range([height, 0]);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x));

                svg.append("g").call(d3.axisLeft(y));

                svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.key))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d.value));
            }

            function createLineChartDeaths(data, selector, title) {
                const margin = { top: 40, right: 20, bottom: 40, left: 50 };
                const width = 400 - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                const svg = d3.select(selector)
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", -10)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(title);

                const x = d3.scaleLinear()
                    .domain(d3.extent(data, d => d.year))
                    .range([0, width]);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.count)])
                    .range([height, 0]);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x).tickFormat(d3.format("d")));

                svg.append("g").call(d3.axisLeft(y));

                const line = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d.count));

                svg.append("path")
                    .datum(data)
                    .attr("class", "line")
                    .attr("d", line)
                    .attr("stroke", "steelblue")
                    .attr("fill", "none");
            }

            function createPieChartDeaths(data, selector, title) {
                const width = 300;
                const height = 300;
                const radius = Math.min(width, height) / 2;

                const svg = d3.select(selector)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", `translate(${width / 2},${height / 2})`);

                svg.append("text")
                    .attr("x", 0)
                    .attr("y", -height / 2 + 20)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(title);

                const color = d3.scaleOrdinal(d3.schemeCategory10);

                const pie = d3.pie()
                    .value(d => d.count);

                const arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);

                const dataReady = pie(data);

                svg.selectAll("path")
                    .data(dataReady)
                    .join("path")
                    .attr("d", arc)
                    .attr("fill", d => color(d.data.region))
                    .style("opacity", 0.8);

                const legend = svg.selectAll(".legend")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("class", "legend")
                    .attr("transform", (d, i) => `translate(-100,${i * 20 - 100})`);

                legend.append("rect")
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", d => color(d.region));

                legend.append("text")
                    .attr("x", 25)
                    .attr("y", 13)
                    .text(d => d.region)
                    .style("font-size", "12px");
            }
        </script>

        <script>
            const csvPath2 = "./data/vih_no_of_people_living_with_hiv_by_country_clean.csv";

            // Load CSV and parse data
            d3.csv(csvPath2, d => ({
                Pays: d.Country,
                Année: +d.Year,
                Médian: +d.Count_median,
                Min: +d.Count_min,
                Max: +d.Count_max,
                Région_OMS: d["WHO Region"]
            })).then(data => {
                // Prepare data for the charts
                const topCountriesHIV = getTopItemsHIV(data, "Pays", 5);
                const topRegionsHIV = getTopItemsHIV(data, "Région_OMS", 5);
                const yearlyTrendHIV = getYearlyTrendHIV(data);

                // Create the charts
                createBarChartHIV(topCountriesHIV, "#chart7", "Top 5 Pays avec le Plus de Personnes Vivant avec le VIH");
                createBarChartHIV(topRegionsHIV, "#chart8", "Top 5 Régions OMS avec le Plus de Personnes Vivant avec le VIH");
                createLineChartHIV(yearlyTrendHIV, "#chart9", "Tendance des Personnes Vivant avec le VIH par Année");
            });

            // Helper functions for data aggregation
            function getTopItemsHIV(data, field, count) {
                const aggregated = d3.rollup(data, v => d3.sum(v, d => d.Médian), d => d[field]);
                return Array.from(aggregated, ([key, value]) => ({ key, value }))
                    .sort((a, b) => b.value - a.value)
                    .slice(0, count);
            }

            function getYearlyTrendHIV(data) {
                const aggregated = d3.rollup(data, v => d3.sum(v, d => d.Médian), d => d.Année);
                return Array.from(aggregated, ([year, count]) => ({ year, count })).sort((a, b) => a.year - b.year);
            }

            // Chart Functions
            function createBarChartHIV(data, selector, title) {
                const margin = { top: 40, right: 20, bottom: 40, left: 50 };
                const width = 400 - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                const svg = d3.select(selector)
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", -10)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(title);

                const x = d3.scaleBand()
                    .domain(data.map(d => d.key))
                    .range([0, width])
                    .padding(0.1);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.value)])
                    .range([height, 0]);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x));

                svg.append("g").call(d3.axisLeft(y));

                svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.key))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d.value));
            }

            function createLineChartHIV(data, selector, title) {
                const margin = { top: 40, right: 20, bottom: 40, left: 50 };
                const width = 400 - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                const svg = d3.select(selector)
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", -10)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(title);

                const x = d3.scaleLinear()
                    .domain(d3.extent(data, d => d.year))
                    .range([0, width]);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.count)])
                    .range([height, 0]);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x).tickFormat(d3.format("d")));

                svg.append("g").call(d3.axisLeft(y));

                const line = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d.count));

                svg.append("path")
                    .datum(data)
                    .attr("class", "line")
                    .attr("d", line)
                    .attr("stroke", "steelblue")
                    .attr("fill", "none");
            }
        </script>


    </body>
</html>
