<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Dual Bar Chart</title>
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
</head>
<body>
<div style="text-align: center; margin-bottom: 20px;">
    <h1>Upload CSV to Visualize Data</h1>
    <input type="file" id="csvUpload" accept=".csv" style="margin-bottom: 20px;">
</div>

<!-- Chart Containers -->
<div id="dualBarChart" style="height: 400px; width: 100%; margin-bottom: 20px;"></div>

<script>
    document.getElementById("csvUpload").addEventListener("change", handleFile);

    function handleFile(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const csvData = e.target.result;
                const parsedData = parseCSV(csvData);

                // Extract necessary columns for dual bar chart
                const countryData = parsedData.map(row => row["Country"]);
                const livingWithHIV = parsedData.map(row => ({
                    label: row["Country"],
                    y: parseFloat(row["Estimated number of people living with HIV"] || 0)
                }));
                const receivingART = parsedData.map(row => ({
                    label: row["Country"],
                    y: parseFloat(row["Reported number of people receiving ART"] || 0)
                }));

                // Render the dual bar chart
                renderDualBarChart(countryData, livingWithHIV, receivingART);
            };
            reader.readAsText(file);
        }
    }

    function parseCSV(csv) {
        const lines = csv.trim().split("\n");
        const headers = lines[0].split("\t"); // Tab-delimited columns
        return lines.slice(1).map(line => {
            const values = line.split("\t");
            return headers.reduce((acc, header, index) => {
                acc[header] = values[index] || "";
                return acc;
            }, {});
        });
    }

    function renderDualBarChart(countryData, livingWithHIV, receivingART) {
        const chart = new CanvasJS.Chart("dualBarChart", {
            theme: "light2",
            animationEnabled: true,
            exportEnabled: true,
            title: {
                text: "Comparison of People Living with HIV and Receiving ART"
            },
            axisY: {
                title: "Number of People",
                includeZero: true
            },
            axisX: {
                title: "Countries",
                interval: 1
            },
            toolTip: {
                shared: true
            },
            legend: {
                cursor: "pointer",
                itemclick: toggleDataSeries
            },
            data: [
                {
                    type: "column",
                    name: "People Living with HIV",
                    showInLegend: true,
                    dataPoints: livingWithHIV
                },
                {
                    type: "column",
                    name: "People Receiving ART",
                    showInLegend: true,
                    dataPoints: receivingART
                }
            ]
        });
        chart.render();

        function toggleDataSeries(e) {
            if (typeof e.dataSeries.visible === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            } else {
                e.dataSeries.visible = true;
            }
            chart.render();
        }
    }
</script>
</body>
</html>
